#!/bin/sh
#
# This script is run once to install essential packages.
# The 'run_once_' prefix ensures it only runs the first time chezmoi applies.
# The '_before_' prefix ensures it runs before other files are created.

set -e

echo "Running package installation script..."

{{ if eq .chezmoi.os "darwin" -}}
# macOS package installation
echo "Detected macOS. Installing packages with Homebrew..."
# No packages to install on macOS at this time.
brew install gh

{{ else if eq .chezmoi.os "linux" -}}
# Linux package installation
if [ -f /etc/os-release ]; then
    . /etc/os-release
    DISTRO=$ID
else
    DISTRO="unknown"
fi

case "$DISTRO" in
    ubuntu|debian)
        echo "Detected Debian/Ubuntu. Installing packages with apt-get..."
        sudo apt-get update
        sudo apt-get install -y gh
        ;;
    fedora|centos|rhel|rocky)
        echo "Detected RHEL/Fedora/Rocky. Installing packages with dnf..."
        sudo dnf install -y gh
        ;;
    *)
        echo "Unsupported Linux distribution: $DISTRO"
        echo "Skipping package installation."
        ;;
esac
{{ end -}}

echo "Package installation script finished."
