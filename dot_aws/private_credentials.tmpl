# ~/.local/share/chezmoi/private_dot_aws/credentials.tmpl
# This template securely populates the AWS credentials file.
# The 'private_' prefix ensures the resulting file has permissions 0600.

# Fetch credentials for the default/personal profile from Vault.
# Assumes a secret named "personal/aws/default" exists and contains a JSON
# object with keys "AccessKeyID" and "SecretAccessKey".
{{- $defaultCreds := vault "secret/data/personal/aws/default" }}
[default]
aws_access_key_id = {{ $defaultCreds.data.AccessKeyID }}
aws_secret_access_key = {{ $defaultCreds.data.SecretAccessKey }}

# Conditionally fetch work credentials only on work machines.
{{ if eq .data.machineType "work" -}}
{{- $workCreds := vault "secret/data/work/aws/developer" }}
[work-account]
aws_access_key_id = {{ $workCreds.data.AccessKeyID }}
aws_secret_access_key = {{ $workCreds.data.SecretAccessKey }}
{{- end }}
